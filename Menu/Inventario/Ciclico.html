<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventário Cíclico - CEVA Logistics</title>

  <link rel="stylesheet" href="styleCiclico.css">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<div class="app-layout">

  <aside class="sidebar">
    <div class="sidebar-header">
      <h3>CEVA Inventário</h3>
    </div>
    <nav class="sidebar-menu">

      <div class="sidebar-item dropdown-rotinas" id="rotinasDropdown">
        <a href="#" class="dropdown-toggle">
          <i class="fas fa-list-ul"></i> <span>Rotinas</span> <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="dropdown-content">
          <a href="Ciclico.html" id="btnCiclico"><i class="fas fa-redo-alt"></i> Cíclico</a>
          <a href="Inventario.html" id="btnClause"><i class="fas fa-balance-scale"></i> Clause</a>
          <a href="RN.html" id="btnRN"><i class="fas fa-tags"></i> RN </a>
          <a href="Vazias.html" id="btnVazias"><i class="fas fa-box-open"></i> VAZIAS </a>
        </div>
      </div>

      <div class="sidebar-item">
        <a href="Dash.html">
          <i class="fas fa-chart-line"></i> Dashboard
        </a>
      </div>

      <div class="sidebar-item">
        <a href="Consulta.html">
          <i class="fas fa-search"></i> CONSULTA
        </a>
      </div>
      <div class="sidebar-item">
        <a href="Relatorio.html">
          <i class="fas fa-file-alt"></i> Relatório
        </a>
      </div>

      <div class="sidebar-item">
        <a href="../Menu.html">
          <i class="fas fa-arrow-circle-left"></i> Voltar (Menu)
        </a>
      </div>

    </nav>
  </aside>

  <main class="main-content">
    <div id="ciclicoContainer" class="rotina-container">
      <header class="content-header">
        <h1>Cíclico</h1>
      </header>

      <div class="search-controls">
        <input type="text" id="searchInput" placeholder="Pesquisar por Nome do Contrato ou Analista...">
        <button id="searchBtn" class="action-btn">
          <i class="fas fa-search"></i> Pesquisar
        </button>
        <button id="addCiclicoBtn" class="action-btn primary-action">
          <i class="fas fa-plus"></i> Adicionar Contrato
        </button>
      </div>

      <p id="mainPageAlert" class="form-message"></p>

      <div id="ciclicoList" class="contracts-grid">
        <p id="loadingMessage" style="color:var(--text-muted);">Carregando contratos...</p>
      </div>
    </div>
  </main>
</div>

<div id="addCiclicoModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Adicionar Novo Contrato (Cíclico)</h2>
    <form id="addCiclicoForm">

      <div class="input-group">
        <label for="contractNameCiclico">Nome do Contrato</label>
        <input type="text" id="contractNameCiclico" required>
      </div>

      <div class="input-group">
        <label for="contractStatusCiclico">Status</label>
        <select type="text" id="contractStatusCiclico" required>
          <option value="ATIVO">ATIVO</option>
          <option value="INATIVO">INATIVO</option>
        </select>
      </div>

      <div class="input-group">
        <label for="analystNameCiclico">Analista Responsável</label>
        <input type="text" id="analystNameCiclico" required>
      </div>

      <button type="submit" class="action-btn primary-action full-width-btn">
        <i class="fas fa-save"></i> Salvar Contrato
      </button>

      <p id="formMessageCiclico" class="form-message"></p>
    </form>
  </div>
</div>

<div id="editStatusModalCiclico" class="modal">
  <div class="modal-content small-modal">
    <span class="close-btn edit-status-close-btn">&times;</span>
    <h2 id="editStatusTitleCiclico">Editar Contrato Cíclico</h2>

    <form id="editStatusFormCiclico">
      <input type="hidden" id="editContractIdInputCiclico">
      <input type="hidden" id="editContractNameInputCiclico">

      <div class="header-info-edit">
        <p>Contrato: <strong id="currentContractNameCiclico"></strong></p>
        <p>Analista Atual: <strong id="currentAnalystDisplayCiclico"></strong></p>
        <p>Status Atual: <strong id="currentStatusDisplayCiclico"></strong></p>
      </div>

      <div class="input-group">
        <label for="newAnalystNameCiclico">Novo Analista Responsável</label>
        <input type="text" id="newAnalystNameCiclico" required>
      </div>

      <div class="input-group">
        <label for="newContractStatusCiclico">Novo Status</label>
        <select id="newContractStatusCiclico" required>
          <option value="ATIVO">ATIVO</option>
          <option value="INATIVO">INATIVO</option>
          <option value="CONCLUIDO">CONCLUÍDO</option>
        </select>
      </div>

      <p id="editStatusFormMessageCiclico" class="form-message"></p>

      <div class="modal-actions-edit">
        <button type="button" id="cancelEditBtnCiclico" class="action-btn secondary-action">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="submit" class="action-btn primary-action">
          <i class="fas fa-check"></i> Salvar Alterações
        </button>
      </div>
    </form>
  </div>
</div>
<div id="deleteConfirmModal" class="modal top-layer"> <div class="modal-content small-modal">
  <span class="close-btn delete-close-btn">&times;</span>
  <h2>Confirmar Exclusão</h2>

  <p id="deleteMessage">Você tem certeza que deseja excluir este item? Esta ação não pode ser desfeita.</p>

  <div class="modal-actions">
    <button id="cancelDeleteBtn" class="action-btn">
      <i class="fas fa-times"></i> Não
    </button>
    <button id="confirmDeleteBtn" class="action-btn primary-action">
      <i class="fas fa-trash-alt"></i> Sim, Excluir
    </button>
  </div>
</div>
</div>

<div id="ciclicoConfigModal" class="modal">
  <div class="modal-content config-modal-size">
    <span class="close-btn">&times;</span>
    <h2>Configuração de Inventário Cíclico</h2>

    <div class="header-info">
      <h3 id="configContractName">Contrato: [Nome do Contrato]</h3>
      <p class="analyst-info"><i class="fas fa-user"></i> Analista: <strong id="configAnalystName"></strong></p>
    </div>

    <form id="ciclicoConfigForm">
      <input type="hidden" id="configContractId">

      <div class="input-group-flex">
        <div class="input-group">
          <label for="totalLocacoes">Total de Locações (Estoque):</label>
          <input type="number" id="totalLocacoes" min="1" required>
        </div>
        <div class="input-group">
          <label for="cicloValue">Dias uteis:</label>
          <input type="number" id="cicloValue" min="1" required>
        </div>
      </div>

      <div class="input-group">
        <label for="regimeTrabalho">Regime de Trabalho:</label>
        <select id="regimeTrabalho" required>
          <option value="DIAS_UTEIS">Apenas Dias Úteis (Seg a Sex)</option>
          <option value="TODOS_OS_DIAS">Todos os Dias (Inclui Sáb/Dom)</option>
          <option value="MANUAL">Seleção Manual (Dias Específicos)</option>
        </select>
      </div>

      <div class="input-group" id="existingGradeGroup">
        <label for="existingGradeSelector">Grade de Referência (Opcional):</label>

        <div class="grade-selector-container-flex">
          <select id="gradeYearSelector" name="gradeYearSelector" class="custom-select">
            <option value="">-- Selecione o Ano --</option>
          </select>

          <select id="existingGradeSelector" name="existingGradeSelector" class="custom-select" disabled>
            <option value="">-- Selecione o Mês (Selecione o Ano Primeiro) --</option>
          </select>

          <button type="button" id="deleteGradeBtn" class="action-btn delete-grade-btn" title="Excluir Grade Selecionada" style="display: none;">
            <i class="fas fa-trash-can"></i>
          </button>
        </div>
        <small style="color: var(--text-muted); font-size: 0.8em;">Se selecionado, ignora Locações/Ciclo e carrega a grade salva.</small>
      </div>
      <div id="monthYearSelectionGroup" class="input-group-flex" style="margin-bottom: 20px;">
        <div class="input-group" style="flex: 1;">
          <label for="monthSelector">Mês de Referência:</label>
          <select id="monthSelector" required>
          </select>
        </div>
        <div class="input-group" style="flex: 1;">
          <label for="yearSelector">Ano de Referência:</label>
          <select id="yearSelector" required>
          </select>
        </div>
      </div>
      <div class="input-group">
        <button type="button" id="manualDaysBtn" class="action-btn full-width-btn" style="background-color: #f0f0f0; color: var(--text-dark); border: 1px solid #ced4da; display: none;">
          <i class="fas fa-calendar-alt"></i> Selecionar Dias Manualmente
        </button>
      </div>

      <p id="configFormMessage" class="form-message"></p>

      <div class="modal-actions-config">
        <button type="button" id="configVoltarBtn" class="action-btn secondary-action">
          <i class="fas fa-arrow-left"></i> Fechar
        </button>
        <button type="submit" class="action-btn primary-action">
          <i class="fas fa-table"></i> Gerar Grade Cíclica
        </button>
      </div>
    </form>
  </div>
</div>


<div id="manualDaysModal" class="modal top-layer"> <div class="modal-content calendar-modal-size">
  <span class="close-btn manual-close-btn">&times;</span>
  <h2>Seleção Manual de Dias de Inventário</h2>

  <p class="calendar-instruction">Clique nos dias que farão parte da contagem cíclica. Dias selecionados ficarão verdes.</p>

  <div id="calendarContainer">
    <div class="calendar-navigation">
      <button type="button" id="prevMonth" class="nav-btn"><i class="fas fa-chevron-left"></i></button>
      <h3 id="currentMonthTitle">Mês Atual</h3>
      <button type="button" id="nextMonth" class="nav-btn"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="calendar-header-days">
      <div class="day-of-week">DOM</div>
      <div class="day-of-week">SEG</div>
      <div class="day-of-week">TER</div>
      <div class="day-of-week">QUA</div>
      <div class="day-of-week">QUI</div>
      <div class="day-of-week">SEX</div>
      <div class="day-of-week">SAB</div>
    </div>

    <div id="calendarGrid" class="calendar-grid">
    </div>
  </div>

  <div class="modal-actions-manual">
    <button type="button" id="manualVoltarBtn" class="action-btn secondary-action">
      <i class="fas fa-arrow-left"></i> Cancelar e Voltar
    </button>
    <button type="button" id="manualSaveBtn" class="action-btn primary-action">
      <i class="fas fa-check"></i> Salvar Seleção
    </button>
  </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="Ciclico.js"></script>
</body>
</html>